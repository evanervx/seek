// Sewing Terms Data
const sewingData = [
  {
    "category": "基础缝纫工具和设备",
    "color": "#FF6B6B",
    "terms": [
      {"term": "Sewing Machine", "chinese": "缝纫机", "definition": "A mechanically driven device that stitches cloth and other materials with thread"},
      {"term": "Needle", "chinese": "缝纫针", "definition": "A sharp, slender tool for stitching"},
      {"term": "Thread", "chinese": "缝纫线", "definition": "A long, thin strand used for sewing"},
      {"term": "Bobbin", "chinese": "梭芯/线轴", "definition": "A cylinder or spindle on which thread is wound"},
      {"term": "Presser Foot", "chinese": "压脚", "definition": "The part that holds fabric in place while stitching"},
      {"term": "Feed Dogs", "chinese": "送布牙", "definition": "Metal teeth that move fabric under the needle"},
      {"term": "Seam Ripper", "chinese": "拆线器", "definition": "A small tool used to cut and remove stitches"},
      {"term": "Scissors", "chinese": "剪刀", "definition": "Cutting tool used for fabric"},
      {"term": "Pins", "chinese": "大头针", "definition": "Small metal fasteners used to hold fabric pieces together temporarily"},
      {"term": "Tape Measure", "chinese": "软尺", "definition": "Flexible measuring device used for taking measurements"},
      {"term": "Thimble", "chinese": "顶针", "definition": "Protective covering for the finger while hand sewing"},
      {"term": "Pin Cushion", "chinese": "针插", "definition": "A padded cushion for holding pins and needles"},
      {"term": "Rotary Cutter", "chinese": "滚轮裁刀", "definition": "A cutting tool with a circular blade for precise fabric cutting"},
      {"term": "Cutting Mat", "chinese": "切割垫", "definition": "Self-healing surface used for cutting fabric"},
      {"term": "Iron", "chinese": "熨斗", "definition": "Device used to press and smooth fabric"}
    ]
  },
  {
    "category": "面料和纹理术语",
    "color": "#4ECDC4",
    "terms": [
      {"term": "Fabric", "chinese": "面料/织物", "definition": "Material made by weaving or knitting fibers"},
      {"term": "Grain", "chinese": "纱向", "definition": "The direction of threads in woven fabric"},
      {"term": "Bias", "chinese": "斜纹/斜向", "definition": "Diagonal direction of fabric at 45-degree angle to grain"},
      {"term": "Selvage", "chinese": "布边", "definition": "Tightly woven edge of fabric that doesn't fray"},
      {"term": "Warp", "chinese": "经线", "definition": "Lengthwise threads in woven fabric"},
      {"term": "Weft", "chinese": "纬线", "definition": "Crosswise threads in woven fabric"},
      {"term": "Nap", "chinese": "绒毛方向", "definition": "Raised surface direction on fabrics like velvet"},
      {"term": "Drape", "chinese": "悬垂性", "definition": "The way fabric hangs or flows"},
      {"term": "Hand", "chinese": "手感", "definition": "The texture or feeling of a fabric"},
      {"term": "Right Side", "chinese": "正面", "definition": "The outer, visible side of fabric"},
      {"term": "Wrong Side", "chinese": "反面", "definition": "The inner, hidden side of fabric"},
      {"term": "Face", "chinese": "正面", "definition": "The front side of fabric"},
      {"term": "Knit Fabric", "chinese": "针织面料", "definition": "Fabric made from interlocking loops of yarn"},
      {"term": "Woven Fabric", "chinese": "梭织面料", "definition": "Fabric made by weaving threads together"},
      {"term": "Stretch Fabric", "chinese": "弹性面料", "definition": "Fabric that can stretch and return to original shape"}
    ]
  },
  {
    "category": "缝纫技术和针法",
    "color": "#45B7D1",
    "terms": [
      {"term": "Seam", "chinese": "缝", "definition": "Line where two pieces of fabric are joined by stitching"},
      {"term": "Backstitch", "chinese": "回针", "definition": "Strong stitch used to secure seam beginnings and ends"},
      {"term": "Running Stitch", "chinese": "平针", "definition": "Simple hand stitch that weaves up and down through fabric"},
      {"term": "Basting", "chinese": "假缝/疏缝", "definition": "Temporary stitching to hold pieces together"},
      {"term": "Blanket Stitch", "chinese": "锁边针", "definition": "Hand stitch used for finishing fabric edges"},
      {"term": "Chain Stitch", "chinese": "链式针迹", "definition": "Looped stitch resembling a chain"},
      {"term": "Cross Stitch", "chinese": "十字绣", "definition": "Two stitches that cross over to create an X shape"},
      {"term": "Zigzag Stitch", "chinese": "Z字针", "definition": "Machine stitch that moves needle side to side"},
      {"term": "Satin Stitch", "chinese": "缎纹针", "definition": "Close zigzag stitch creating solid coverage"},
      {"term": "Topstitch", "chinese": "明线", "definition": "Decorative stitching on outside of garment"},
      {"term": "Understitch", "chinese": "压线", "definition": "Stitching close to seam on facing side"},
      {"term": "Edgestitch", "chinese": "边缘线", "definition": "Straight stitch sewn very close to fabric edge"},
      {"term": "Stitch in the Ditch", "chinese": "压缝线", "definition": "Sewing directly into the seam line"},
      {"term": "French Seam", "chinese": "法式缝", "definition": "Seam that encloses raw edges"},
      {"term": "Overlock Stitch", "chinese": "包缝针", "definition": "Stitch that trims and finishes fabric edges"}
    ]
  },
  {
    "category": "版型制作术语",
    "color": "#96CEB4",
    "terms": [
      {"term": "Pattern", "chinese": "纸样/版型", "definition": "Template used to cut fabric pieces"},
      {"term": "Seam Allowance", "chinese": "缝份", "definition": "Area between fabric edge and stitching line"},
      {"term": "Dart", "chinese": "省道", "definition": "Folded wedge of fabric to create shape"},
      {"term": "Notch", "chinese": "刀眼", "definition": "Marks that help align pattern pieces"},
      {"term": "Grainline", "chinese": "纱向线", "definition": "Arrow on pattern showing fabric grain direction"},
      {"term": "Cutting Line", "chinese": "裁剪线", "definition": "Line showing where to cut fabric"},
      {"term": "Fold Line", "chinese": "折叠线", "definition": "Line indicating where to fold fabric"},
      {"term": "Armscye", "chinese": "袖窿", "definition": "Armhole opening where sleeve attaches"},
      {"term": "Block", "chinese": "基础版型", "definition": "Basic pattern piece representing garment shape"},
      {"term": "Ease", "chinese": "松量", "definition": "Extra space in pattern for fit and movement"},
      {"term": "Bust Point", "chinese": "胸点", "definition": "Most prominent point of the bust"},
      {"term": "Center Front (CF)", "chinese": "前中心线", "definition": "Center line of garment front"},
      {"term": "Center Back (CB)", "chinese": "后中心线", "definition": "Center line of garment back"},
      {"term": "Apex", "chinese": "省尖", "definition": "Point where dart tapers and ends"},
      {"term": "Balance Point", "chinese": "平衡点", "definition": "Marks that help align garment pieces"}
    ]
  },
  {
    "category": "服装构造术语",
    "color": "#FECA57",
    "terms": [
      {"term": "Hem", "chinese": "下摆", "definition": "Finished bottom edge of garment"},
      {"term": "Facing", "chinese": "贴边", "definition": "Fabric piece sewn to finish edges neatly"},
      {"term": "Interfacing", "chinese": "衬布", "definition": "Material added for structure and stability"},
      {"term": "Lining", "chinese": "里布", "definition": "Inner layer of fabric in garment"},
      {"term": "Binding", "chinese": "滚边", "definition": "Strip of fabric used to finish edges"},
      {"term": "Bias Tape", "chinese": "斜布条", "definition": "Strip of fabric cut on bias for finishing"},
      {"term": "Zipper", "chinese": "拉链", "definition": "Closure with two rows of interlocking teeth"},
      {"term": "Button", "chinese": "纽扣", "definition": "Small disc used as fastener"},
      {"term": "Buttonhole", "chinese": "扣眼", "definition": "Sewn hole for button to pass through"},
      {"term": "Placket", "chinese": "门襟", "definition": "Opening with closure like buttons"},
      {"term": "Collar", "chinese": "领子", "definition": "Part of garment around neck"},
      {"term": "Cuff", "chinese": "袖口", "definition": "Finished edge of sleeve"},
      {"term": "Sleeve", "chinese": "袖子", "definition": "Part of garment covering arm"},
      {"term": "Bodice", "chinese": "上身", "definition": "Upper part of dress or garment"},
      {"term": "Waistband", "chinese": "腰带", "definition": "Band of fabric at waist"}
    ]
  },
  {
    "category": "装饰技术",
    "color": "#FF9FF3",
    "terms": [
      {"term": "Appliqué", "chinese": "贴花", "definition": "Decorative fabric sewn onto another fabric"},
      {"term": "Embroidery", "chinese": "刺绣", "definition": "Decorative stitching on fabric"},
      {"term": "Pleats", "chinese": "褶皱", "definition": "Folds in fabric creating controlled fullness"},
      {"term": "Gathering", "chinese": "抽褶", "definition": "Bunching fabric together to create fullness"},
      {"term": "Shirring", "chinese": "抽褶装饰", "definition": "Multiple rows of gathering for decoration"},
      {"term": "Smocking", "chinese": "褶饰", "definition": "Decorative stitching on gathered fabric"},
      {"term": "Tuck", "chinese": "裥", "definition": "Stitched fold of fabric for shape or decoration"},
      {"term": "Piping", "chinese": "滚边条", "definition": "Decorative trim inserted into seams"},
      {"term": "Trim", "chinese": "装饰边", "definition": "Decorative material added to garments"},
      {"term": "Beading", "chinese": "珠绣", "definition": "Decorative addition of beads to fabric"},
      {"term": "Sequins", "chinese": "亮片", "definition": "Small decorative discs sewn onto fabric"},
      {"term": "Fringe", "chinese": "流苏", "definition": "Decorative border of hanging threads"},
      {"term": "Ruffle", "chinese": "荷叶边", "definition": "Strip of gathered fabric used as trim"},
      {"term": "Box Pleat", "chinese": "工字褶", "definition": "Pleat with two folds facing opposite directions"},
      {"term": "Knife Pleat", "chinese": "刀褶", "definition": "Single pleat folded in one direction"}
    ]
  },
  {
    "category": "质量控制和整理",
    "color": "#54A0FF",
    "terms": [
      {"term": "Press", "chinese": "熨烫", "definition": "Using iron to flatten and shape fabric"},
      {"term": "Grade", "chinese": "修剪", "definition": "Trimming seam allowances to reduce bulk"},
      {"term": "Clip", "chinese": "剪牙口", "definition": "Small cuts in seam allowance on curves"},
      {"term": "Notch", "chinese": "剪V口", "definition": "V-shaped cuts to remove bulk"},
      {"term": "Finish", "chinese": "整理", "definition": "Final treatment of seam edges"},
      {"term": "Trim", "chinese": "修边", "definition": "Cutting away excess fabric"},
      {"term": "Turn", "chinese": "翻转", "definition": "Turning fabric to right side"},
      {"term": "Anchor", "chinese": "固定", "definition": "Securing stitches at beginning and end"},
      {"term": "Lock Stitch", "chinese": "锁式针迹", "definition": "Machine stitch that locks threads together"},
      {"term": "Tension", "chinese": "张力", "definition": "Tightness control of thread"},
      {"term": "Feed", "chinese": "送料", "definition": "Movement of fabric through machine"},
      {"term": "Backstitch", "chinese": "倒缝", "definition": "Reverse stitches to secure seams"},
      {"term": "Overcast", "chinese": "包边", "definition": "Stitching over raw edges"},
      {"term": "Blind Hem", "chinese": "暗缝", "definition": "Hidden hemming technique"},
      {"term": "Whipstitch", "chinese": "锁边针", "definition": "Stitch wrapping around fabric edge"}
    ]
  },
  {
    "category": "现代缝纫技术",
    "color": "#5F27CD",
    "terms": [
      {"term": "Serger", "chinese": "包缝机", "definition": "Machine that trims and finishes edges simultaneously"},
      {"term": "Overlocker", "chinese": "锁边机", "definition": "Machine for finishing fabric edges"},
      {"term": "Free Motion Quilting", "chinese": "自由压线", "definition": "Moving fabric freely under needle for decorative quilting"},
      {"term": "Computerized Sewing", "chinese": "电脑缝纫", "definition": "Machine-controlled precision stitching"},
      {"term": "Automatic Buttonhole", "chinese": "自动扣眼", "definition": "Machine-made buttonholes"},
      {"term": "Walking Foot", "chinese": "走布压脚", "definition": "Foot that feeds multiple layers evenly"},
      {"term": "Invisible Zipper", "chinese": "隐形拉链", "definition": "Zipper designed to be hidden in seam"},
      {"term": "Fusible Interfacing", "chinese": "粘合衬", "definition": "Iron-on interfacing material"},
      {"term": "Double Needle", "chinese": "双针", "definition": "Needle creating parallel rows of stitching"},
      {"term": "Ballpoint Needle", "chinese": "圆头针", "definition": "Needle designed for knit fabrics"},
      {"term": "Thread Cutter", "chinese": "切线器", "definition": "Built-in blade for cutting thread"},
      {"term": "Needle Threader", "chinese": "穿线器", "definition": "Device helping thread needles"},
      {"term": "LCD Display", "chinese": "液晶显示屏", "definition": "Electronic display on modern machines"},
      {"term": "USB Port", "chinese": "USB接口", "definition": "Connection for downloading patterns"},
      {"term": "Embroidery Hoop", "chinese": "绣花绷", "definition": "Frame keeping fabric taut for embroidery"}
    ]
  }
];

// Global state
let currentCategory = 'all';
let currentSearchTerm = '';
let allTerms = [];

// Initialize application
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
});

function initializeApp() {
    // Flatten all terms into a single array
    allTerms = sewingData.flatMap(category => 
        category.terms.map(term => ({
            ...term,
            category: category.category,
            color: category.color
        }))
    );
    
    // Set up event listeners
    setupEventListeners();
    
    // Initial render
    renderTerms(allTerms);
    updateStatistics(allTerms.length);
}

function setupEventListeners() {
    // Search input with debouncing
    const searchInput = document.getElementById('search-input');
    searchInput.addEventListener('input', debounce(handleSearch, 300));
    
    // Category filter buttons
    const categoryButtons = document.querySelectorAll('.btn--category');
    categoryButtons.forEach(button => {
        button.addEventListener('click', handleCategoryFilter);
    });
    
    // Add keyboard navigation for accessibility
    document.addEventListener('keydown', handleKeyNavigation);
}

function handleSearch(event) {
    currentSearchTerm = event.target.value.toLowerCase().trim();
    filterAndRenderTerms();
}

function handleCategoryFilter(event) {
    const category = event.target.dataset.category;
    
    // Update active button
    document.querySelectorAll('.btn--category').forEach(btn => 
        btn.classList.remove('active')
    );
    event.target.classList.add('active');
    
    currentCategory = category;
    filterAndRenderTerms();
    
    // Smooth scroll to terms section
    setTimeout(() => {
        document.querySelector('.terms-section').scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
    }, 100);
}

function filterAndRenderTerms() {
    let filteredTerms = allTerms;
    
    // Apply search filter first (across all terms)
    if (currentSearchTerm) {
        filteredTerms = filteredTerms.filter(term => 
            term.term.toLowerCase().includes(currentSearchTerm) ||
            term.chinese.toLowerCase().includes(currentSearchTerm) ||
            term.definition.toLowerCase().includes(currentSearchTerm)
        );
    }
    
    // Then apply category filter only if a specific category is selected
    // and there's no search term (to avoid the zero results bug)
    if (currentCategory !== 'all' && !currentSearchTerm) {
        filteredTerms = filteredTerms.filter(term => 
            term.category === currentCategory
        );
    }
    
    renderTerms(filteredTerms);
    updateStatistics(filteredTerms.length);
}

function renderTerms(terms) {
    const termsGrid = document.getElementById('terms-grid');
    const noResults = document.getElementById('no-results');
    
    if (terms.length === 0) {
        termsGrid.style.display = 'none';
        noResults.classList.remove('hidden');
        return;
    }
    
    termsGrid.style.display = 'grid';
    noResults.classList.add('hidden');
    
    // Create term cards HTML
    const termsHTML = terms.map((term, index) => `
        <div class="term-card" 
             data-category="${term.category}"
             data-term="${term.term}"
             data-chinese="${term.chinese}"
             data-definition="${term.definition}"
             style="animation-delay: ${(index % 6) * 0.1}s">
            <div class="term-card__category">${term.category}</div>
            <div class="term-card__english">${term.term}</div>
            <div class="term-card__chinese">${term.chinese}</div>
            <div class="term-card__definition">${term.definition}</div>
        </div>
    `).join('');
    
    termsGrid.innerHTML = termsHTML;
    
    // Add click handlers for term cards
    addTermCardInteractions();
}

function addTermCardInteractions() {
    const termCards = document.querySelectorAll('.term-card');
    
    termCards.forEach(card => {
        // Add hover effects
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-4px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
        
        // Add click interaction with expanded details
        card.addEventListener('click', function() {
            showTermDetails(this);
        });
        
        // Add keyboard support
        card.setAttribute('tabindex', '0');
        card.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                showTermDetails(this);
            }
        });
    });
}

function showTermDetails(cardElement) {
    // Create a subtle pulse effect
    cardElement.style.transform = 'scale(0.95)';
    setTimeout(() => {
        cardElement.style.transform = 'translateY(-4px) scale(1.02)';
    }, 150);
    
    // Get term data
    const term = cardElement.dataset.term;
    const chinese = cardElement.dataset.chinese;
    const definition = cardElement.dataset.definition;
    const category = cardElement.dataset.category;
    
    // Create and show modal/popup with detailed information
    showDetailModal(term, chinese, definition, category);
}

function showDetailModal(term, chinese, definition, category) {
    // Remove existing modal if any
    const existingModal = document.querySelector('.term-modal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Create modal HTML
    const modal = document.createElement('div');
    modal.className = 'term-modal';
    modal.innerHTML = `
        <div class="term-modal__backdrop"></div>
        <div class="term-modal__content">
            <div class="term-modal__header">
                <h2>${term}</h2>
                <button class="term-modal__close" aria-label="关闭">×</button>
            </div>
            <div class="term-modal__body">
                <div class="term-modal__chinese">${chinese}</div>
                <div class="term-modal__category">分类: ${category}</div>
                <div class="term-modal__definition">
                    <h4>定义:</h4>
                    <p>${definition}</p>
                </div>
                <div class="term-modal__actions">
                    <button class="btn btn--primary term-modal__copy">复制术语</button>
                    <button class="btn btn--secondary term-modal__close-btn">关闭</button>
                </div>
            </div>
        </div>
    `;
    
    // Add modal styles
    const modalStyles = `
        .term-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-16);
        }
        
        .term-modal__backdrop {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .term-modal__content {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            position: relative;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .term-modal__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-20);
            border-bottom: 1px solid var(--color-border);
        }
        
        .term-modal__header h2 {
            margin: 0;
            color: var(--color-primary);
        }
        
        .term-modal__close {
            background: none;
            border: none;
            font-size: var(--font-size-3xl);
            cursor: pointer;
            color: var(--color-text-secondary);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            transition: all var(--duration-fast) var(--ease-standard);
        }
        
        .term-modal__close:hover {
            background: var(--color-secondary);
            color: var(--color-text);
        }
        
        .term-modal__body {
            padding: var(--space-20);
        }
        
        .term-modal__chinese {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            color: var(--color-primary);
            margin-bottom: var(--space-12);
        }
        
        .term-modal__category {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-16);
            padding: var(--space-4) var(--space-8);
            background: var(--color-secondary);
            border-radius: var(--radius-sm);
            display: inline-block;
        }
        
        .term-modal__definition h4 {
            margin: 0 0 var(--space-8) 0;
            font-size: var(--font-size-md);
        }
        
        .term-modal__definition p {
            margin: 0;
            line-height: var(--line-height-normal);
            color: var(--color-text-secondary);
        }
        
        .term-modal__actions {
            display: flex;
            gap: var(--space-12);
            margin-top: var(--space-20);
        }
        
        .term-modal__copy {
            flex: 1;
        }
        
        .term-modal__close-btn {
            flex: 1;
        }
    `;
    
    // Add styles to head if not already present
    if (!document.querySelector('#modal-styles')) {
        const styleSheet = document.createElement('style');
        styleSheet.id = 'modal-styles';
        styleSheet.textContent = modalStyles;
        document.head.appendChild(styleSheet);
    }
    
    // Add modal to body
    document.body.appendChild(modal);
    
    // Add event listeners
    const closeModal = () => {
        modal.style.animation = 'modalFadeOut 0.3s ease-out';
        setTimeout(() => modal.remove(), 300);
    };
    
    // Close button
    modal.querySelector('.term-modal__close').addEventListener('click', closeModal);
    modal.querySelector('.term-modal__close-btn').addEventListener('click', closeModal);
    
    // Backdrop click
    modal.querySelector('.term-modal__backdrop').addEventListener('click', closeModal);
    
    // Copy button
    modal.querySelector('.term-modal__copy').addEventListener('click', () => {
        const textToCopy = `${term} (${chinese}): ${definition}`;
        navigator.clipboard.writeText(textToCopy).then(() => {
            const copyBtn = modal.querySelector('.term-modal__copy');
            const originalText = copyBtn.textContent;
            copyBtn.textContent = '已复制!';
            setTimeout(() => {
                copyBtn.textContent = originalText;
            }, 2000);
        });
    });
    
    // Escape key
    const handleEscape = (e) => {
        if (e.key === 'Escape') {
            closeModal();
            document.removeEventListener('keydown', handleEscape);
        }
    };
    document.addEventListener('keydown', handleEscape);
}

function updateStatistics(filteredCount) {
    const totalTermsEl = document.getElementById('total-terms');
    const totalCategoriesEl = document.getElementById('total-categories');
    const filteredTermsEl = document.getElementById('filtered-terms');
    
    // Animate number changes
    animateNumber(totalTermsEl, allTerms.length);
    animateNumber(totalCategoriesEl, sewingData.length);
    animateNumber(filteredTermsEl, filteredCount);
}

function animateNumber(element, targetNumber) {
    const currentNumber = parseInt(element.textContent) || 0;
    const duration = 500;
    const steps = 20;
    const increment = (targetNumber - currentNumber) / steps;
    
    let current = currentNumber;
    let step = 0;
    
    const timer = setInterval(() => {
        current += increment;
        step++;
        
        if (step >= steps) {
            current = targetNumber;
            clearInterval(timer);
        }
        
        element.textContent = Math.round(current);
    }, duration / steps);
}

function handleKeyNavigation(event) {
    // Add keyboard shortcuts for better accessibility
    if (event.ctrlKey || event.metaKey) {
        switch(event.key) {
            case 'f':
            case 'F':
                event.preventDefault();
                document.getElementById('search-input').focus();
                break;
        }
    }
    
    // Escape key clears search
    if (event.key === 'Escape') {
        const searchInput = document.getElementById('search-input');
        if (searchInput === document.activeElement) {
            searchInput.value = '';
            currentSearchTerm = '';
            filterAndRenderTerms();
        }
    }
}

// Debounce function for performance optimization
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Add fade out animation for modal
const additionalModalStyles = `
    @keyframes modalFadeOut {
        from {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
        to {
            opacity: 0;
            transform: scale(0.9) translateY(-20px);
        }
    }
`;

// Add the additional styles
document.addEventListener('DOMContentLoaded', function() {
    const additionalStyleSheet = document.createElement('style');
    additionalStyleSheet.textContent = additionalModalStyles;
    document.head.appendChild(additionalStyleSheet);
});